"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/utils/server.ts
var server_exports = {};
__export(server_exports, {
  env: () => env,
  getRaidTweetChClient: () => getRaidTweetChClient,
  getRawChClient: () => getRawChClient,
  minifyRawRaidTweet: () => minifyRawRaidTweet,
  redisOps: () => redisOps,
  sendRaidTweet: () => sendRaidTweet,
  sendRawRaidTweet: () => sendRawRaidTweet,
  unpackRawRaidTweetMini: () => unpackRawRaidTweetMini,
  zConfig: () => zConfig,
  zRaidTweetMini: () => zRaidTweetMini,
  zRawRaidTweetMini: () => zRawRaidTweetMini
});
module.exports = __toCommonJS(server_exports);

// src/config.ts
var import_zod = require("zod");
var dotenv = __toESM(require("dotenv"));
dotenv.config();
var zConfig = import_zod.z.object({
  OAUTH_CALLBACK: import_zod.z.string().url(),
  // CLIENT_ID: z.string(),
  // CLIENT_SECRET: z.string(),
  CONSUMER_KEY: import_zod.z.string(),
  CONSUMER_SECRET: import_zod.z.string(),
  PORT: import_zod.z.string(),
  CACHE_PORT: import_zod.z.string(),
  STREAM_PORT: import_zod.z.string(),
  GBS_LIST: import_zod.z.string().url(),
  REDIS_HOST: import_zod.z.string(),
  REDIS_PORT: import_zod.z.string(),
  REDIS_PASS: import_zod.z.string()
});
var env = zConfig.parse(process.env);

// src/redis/index.ts
var import_ioredis = __toESM(require("ioredis"));

// src/redis/schema.ts
var import_zod2 = require("zod");
var zRawRaidTweetMini = import_zod2.z.object({
  n: import_zod2.z.string(),
  // name
  sn: import_zod2.z.string(),
  // screen_name
  en: import_zod2.z.string(),
  // enemy_name
  ui: import_zod2.z.number(),
  // user_id
  ti: import_zod2.z.number(),
  // tweet_id
  bi: import_zod2.z.string(),
  // battle_id
  lv: import_zod2.z.string(),
  // level
  l: import_zod2.z.enum(["en", "ja"]),
  // language
  t: import_zod2.z.number(),
  // time
  c: import_zod2.z.string().optional()
  // comment
});
function minifyRawRaidTweet(tweet) {
  return {
    n: tweet.name,
    sn: tweet.screen_name,
    en: tweet.enemy_name,
    ui: tweet.user_id,
    ti: tweet.tweet_id,
    bi: tweet.battle_id,
    lv: tweet.level,
    l: tweet.language,
    t: tweet.time,
    c: tweet.comment
  };
}
function unpackRawRaidTweetMini(mini) {
  return {
    name: mini.n,
    screen_name: mini.sn,
    enemy_name: mini.en,
    user_id: mini.ui,
    tweet_id: mini.ti,
    battle_id: mini.bi,
    level: mini.lv,
    language: mini.l,
    time: mini.t,
    comment: mini.c
  };
}
var zRaidTweetMini = import_zod2.z.object({
  n: import_zod2.z.string(),
  // name
  sn: import_zod2.z.string(),
  // screen_name
  ui: import_zod2.z.number(),
  // user_id
  ti: import_zod2.z.number(),
  // tweet_id
  bi: import_zod2.z.string(),
  // battle_id
  ei: import_zod2.z.number(),
  // enemy_id(-1はリスト外)
  lv: import_zod2.z.string().optional(),
  // level
  en: import_zod2.z.string().optional(),
  // enemy_name
  l: import_zod2.z.enum(["en", "ja"]),
  // language
  t: import_zod2.z.number(),
  // time
  ft: import_zod2.z.number(),
  // first time(初回投稿時間)
  c: import_zod2.z.string().optional()
  // comment
});

// src/redis/index.ts
var import_mitt = __toESM(require("mitt"));
var redisOps = {
  host: env.REDIS_HOST,
  password: env.REDIS_PASS,
  port: Number.parseInt(env.REDIS_PORT)
};
function getRawChClient() {
  const receiver = (0, import_mitt.default)();
  const subRedis = new import_ioredis.default(redisOps);
  subRedis.subscribe("gbs-open-raw");
  subRedis.on("message", (ch, json) => {
    try {
      const mini = zRawRaidTweetMini.parse(JSON.parse(json));
      receiver.emit("tweet", mini);
    } catch {
    }
  });
  return receiver;
}
function getRaidTweetChClient() {
  const receiver = (0, import_mitt.default)();
  const subRedis = new import_ioredis.default(redisOps);
  subRedis.subscribe("gbs-open-tweet");
  subRedis.on("message", (ch, json) => {
    try {
      const mini = zRaidTweetMini.parse(JSON.parse(json));
      receiver.emit("tweet", mini);
    } catch {
    }
  });
  return receiver;
}
var pubRedis = new import_ioredis.default(redisOps);
function sendRawRaidTweet(tweet) {
  const mini = minifyRawRaidTweet(tweet);
  const json = JSON.stringify(mini);
  pubRedis.publish("gbs-open-raw", json);
}
function sendRaidTweet(tweet) {
  const json = JSON.stringify(tweet);
  pubRedis.publish("gbs-open-tweet", json);
}

// src/tweet/receiver.ts
var import_mitt2 = __toESM(require("mitt"));
var import_gbf_tweet_parser = require("@totoraj930/gbf-tweet-parser");
var import_twitter_api_v2 = require("twitter-api-v2");

// src/db.ts
var import_client = require("@prisma/client");
var import_uuid = require("uuid");
var prisma = new import_client.PrismaClient();

// src/tweet/receiver.ts
var tweetReceiver = (0, import_mitt2.default)();
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  env,
  getRaidTweetChClient,
  getRawChClient,
  minifyRawRaidTweet,
  redisOps,
  sendRaidTweet,
  sendRawRaidTweet,
  unpackRawRaidTweetMini,
  zConfig,
  zRaidTweetMini,
  zRawRaidTweetMini
});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL3V0aWxzL3NlcnZlci50cyIsICIuLi9zcmMvY29uZmlnLnRzIiwgIi4uL3NyYy9yZWRpcy9pbmRleC50cyIsICIuLi9zcmMvcmVkaXMvc2NoZW1hLnRzIiwgIi4uL3NyYy90d2VldC9yZWNlaXZlci50cyIsICIuLi9zcmMvZGIudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8vIFx1NTE4NVx1OTBFOFx1MzBCNVx1MzBGQ1x1MzBEMFx1MzBGQ1x1NTQxMVx1MzA1MVx1MzA2RWV4cG9ydFxyXG5cclxuZXhwb3J0ICogZnJvbSAnQC9yZWRpcyc7XHJcbmV4cG9ydCAqIGZyb20gJ0AvcmVkaXMvc2NoZW1hJztcclxuZXhwb3J0ICogZnJvbSAnQC9jb25maWcnO1xyXG5leHBvcnQgeyBSYXdSYWlkVHdlZXQgfSBmcm9tICdAL3R3ZWV0L3JlY2VpdmVyJztcclxuIiwgImltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xyXG5pbXBvcnQgKiBhcyBkb3RlbnYgZnJvbSAnZG90ZW52JztcclxuZG90ZW52LmNvbmZpZygpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHpDb25maWcgPSB6Lm9iamVjdCh7XHJcbiAgT0FVVEhfQ0FMTEJBQ0s6IHouc3RyaW5nKCkudXJsKCksXHJcbiAgLy8gQ0xJRU5UX0lEOiB6LnN0cmluZygpLFxyXG4gIC8vIENMSUVOVF9TRUNSRVQ6IHouc3RyaW5nKCksXHJcbiAgQ09OU1VNRVJfS0VZOiB6LnN0cmluZygpLFxyXG4gIENPTlNVTUVSX1NFQ1JFVDogei5zdHJpbmcoKSxcclxuICBQT1JUOiB6LnN0cmluZygpLFxyXG5cclxuICBDQUNIRV9QT1JUOiB6LnN0cmluZygpLFxyXG4gIFNUUkVBTV9QT1JUOiB6LnN0cmluZygpLFxyXG5cclxuICBHQlNfTElTVDogei5zdHJpbmcoKS51cmwoKSxcclxuXHJcbiAgUkVESVNfSE9TVDogei5zdHJpbmcoKSxcclxuICBSRURJU19QT1JUOiB6LnN0cmluZygpLFxyXG4gIFJFRElTX1BBU1M6IHouc3RyaW5nKCksXHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IGVudiA9IHpDb25maWcucGFyc2UocHJvY2Vzcy5lbnYpO1xyXG4iLCAiaW1wb3J0IHsgZW52IH0gZnJvbSAnQC9jb25maWcnO1xyXG5pbXBvcnQgeyBSYXdSYWlkVHdlZXQgfSBmcm9tICdAL3R3ZWV0L3JlY2VpdmVyJztcclxuaW1wb3J0IFJlZGlzLCB7IFJlZGlzT3B0aW9ucyB9IGZyb20gJ2lvcmVkaXMnO1xyXG5pbXBvcnQge1xyXG4gIG1pbmlmeVJhd1JhaWRUd2VldCxcclxuICBSYWlkVHdlZXRNaW5pLFxyXG4gIFJhd1JhaWRUd2VldE1pbmksXHJcbiAgdW5wYWNrUmF3UmFpZFR3ZWV0TWluaSxcclxuICB6UmFpZFR3ZWV0TWluaSxcclxuICB6UmF3UmFpZFR3ZWV0TWluaSxcclxufSBmcm9tICcuL3NjaGVtYSc7XHJcbmltcG9ydCBtaXR0IGZyb20gJ21pdHQnO1xyXG5cclxuZXhwb3J0IGNvbnN0IHJlZGlzT3BzID0ge1xyXG4gIGhvc3Q6IGVudi5SRURJU19IT1NULFxyXG4gIHBhc3N3b3JkOiBlbnYuUkVESVNfUEFTUyxcclxuICBwb3J0OiBOdW1iZXIucGFyc2VJbnQoZW52LlJFRElTX1BPUlQpLFxyXG59O1xyXG5cclxudHlwZSBSYXdDaEV2ZW50cyA9IHtcclxuICB0d2VldDogUmF3UmFpZFR3ZWV0TWluaTtcclxufTtcclxuLyoqXHJcbiAqIFx1NzUxRlx1MzA2RVx1MzBDNFx1MzBBNFx1MzBGQ1x1MzBDOFx1NTNEN1x1NEZFMVx1NkE1RlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJhd0NoQ2xpZW50KCkge1xyXG4gIGNvbnN0IHJlY2VpdmVyID0gbWl0dDxSYXdDaEV2ZW50cz4oKTtcclxuICBjb25zdCBzdWJSZWRpcyA9IG5ldyBSZWRpcyhyZWRpc09wcyk7XHJcbiAgc3ViUmVkaXMuc3Vic2NyaWJlKCdnYnMtb3Blbi1yYXcnKTtcclxuICBzdWJSZWRpcy5vbignbWVzc2FnZScsIChjaCwganNvbikgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgbWluaSA9IHpSYXdSYWlkVHdlZXRNaW5pLnBhcnNlKEpTT04ucGFyc2UoanNvbikpO1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhEYXRlLm5vdygpIC0gbWluaS50LCBtaW5pLmJpLCBgTHYuJHttaW5pLmx2fWAsIG1pbmkuZW4pO1xyXG4gICAgICByZWNlaXZlci5lbWl0KCd0d2VldCcsIG1pbmkpO1xyXG4gICAgfSBjYXRjaCB7fVxyXG4gIH0pO1xyXG4gIHJldHVybiByZWNlaXZlcjtcclxufVxyXG5cclxudHlwZSBSYWlkVHdlZXRDaEV2ZW50cyA9IHtcclxuICB0d2VldDogUmFpZFR3ZWV0TWluaTtcclxufTtcclxuLyoqXHJcbiAqIFx1NUI4Q1x1NjIxMFx1NkUwOFx1MzA3Rlx1MzA2RVx1MzBDNFx1MzBBNFx1MzBGQ1x1MzBDOFx1NTNEN1x1NEZFMVx1NkE1RlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJhaWRUd2VldENoQ2xpZW50KCkge1xyXG4gIGNvbnN0IHJlY2VpdmVyID0gbWl0dDxSYWlkVHdlZXRDaEV2ZW50cz4oKTtcclxuICBjb25zdCBzdWJSZWRpcyA9IG5ldyBSZWRpcyhyZWRpc09wcyk7XHJcbiAgc3ViUmVkaXMuc3Vic2NyaWJlKCdnYnMtb3Blbi10d2VldCcpO1xyXG4gIHN1YlJlZGlzLm9uKCdtZXNzYWdlJywgKGNoLCBqc29uKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBtaW5pID0gelJhaWRUd2VldE1pbmkucGFyc2UoSlNPTi5wYXJzZShqc29uKSk7XHJcbiAgICAgIHJlY2VpdmVyLmVtaXQoJ3R3ZWV0JywgbWluaSk7XHJcbiAgICB9IGNhdGNoIHt9XHJcbiAgfSk7XHJcbiAgcmV0dXJuIHJlY2VpdmVyO1xyXG59XHJcblxyXG4vKipcclxuICogXHU5MDAxXHU0RkUxXHU3NTI4UmVkaXNcdTMwQUZcdTMwRTlcdTMwQTRcdTMwQTJcdTMwRjNcdTMwQzhcclxuICovXHJcbmNvbnN0IHB1YlJlZGlzID0gbmV3IFJlZGlzKHJlZGlzT3BzKTtcclxuXHJcbi8qKlxyXG4gKiBcdTc1MUZcdTMwNkVcdTMwQzRcdTMwQTRcdTMwRkNcdTMwQzhcdTMwQzdcdTMwRkNcdTMwQkZcdTMwOTJcdTkwMDFcdTRGRTFcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzZW5kUmF3UmFpZFR3ZWV0KHR3ZWV0OiBSYXdSYWlkVHdlZXQpIHtcclxuICBjb25zdCBtaW5pID0gbWluaWZ5UmF3UmFpZFR3ZWV0KHR3ZWV0KTtcclxuICBjb25zdCBqc29uID0gSlNPTi5zdHJpbmdpZnkobWluaSk7XHJcbiAgcHViUmVkaXMucHVibGlzaCgnZ2JzLW9wZW4tcmF3JywganNvbik7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBcdTUyQTBcdTVERTVcdTZFMDhcdTMwN0ZcdTMwNkVcdTMwQzRcdTMwQTRcdTMwRkNcdTMwQzhcdTMwQzdcdTMwRkNcdTMwQkZcdTMwOTJcdTkwMDFcdTRGRTFcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzZW5kUmFpZFR3ZWV0KHR3ZWV0OiBSYWlkVHdlZXRNaW5pKSB7XHJcbiAgY29uc3QganNvbiA9IEpTT04uc3RyaW5naWZ5KHR3ZWV0KTtcclxuICBwdWJSZWRpcy5wdWJsaXNoKCdnYnMtb3Blbi10d2VldCcsIGpzb24pO1xyXG59XHJcbiIsICJpbXBvcnQgeyBSYXdSYWlkVHdlZXQgfSBmcm9tICdAL3R3ZWV0L3JlY2VpdmVyJztcclxuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XHJcblxyXG4vKipcclxuICogUmVkaXNcdTkwMDFcdTRGRTFcdTc1MjhcdTMwNkVcdTY1ODdcdTVCNTdcdTY1NzBcdTMwOTJcdTYyOTFcdTMwNDhcdTMwNUZSYWlkVHdlZXRcclxuICovXHJcbmV4cG9ydCBjb25zdCB6UmF3UmFpZFR3ZWV0TWluaSA9IHoub2JqZWN0KHtcclxuICBuOiB6LnN0cmluZygpLCAvLyBuYW1lXHJcbiAgc246IHouc3RyaW5nKCksIC8vIHNjcmVlbl9uYW1lXHJcbiAgZW46IHouc3RyaW5nKCksIC8vIGVuZW15X25hbWVcclxuICB1aTogei5udW1iZXIoKSwgLy8gdXNlcl9pZFxyXG4gIHRpOiB6Lm51bWJlcigpLCAvLyB0d2VldF9pZFxyXG4gIGJpOiB6LnN0cmluZygpLCAvLyBiYXR0bGVfaWRcclxuICBsdjogei5zdHJpbmcoKSwgLy8gbGV2ZWxcclxuICBsOiB6LmVudW0oWydlbicsICdqYSddKSwgLy8gbGFuZ3VhZ2VcclxuICB0OiB6Lm51bWJlcigpLCAvLyB0aW1lXHJcbiAgYzogei5zdHJpbmcoKS5vcHRpb25hbCgpLCAvLyBjb21tZW50XHJcbn0pO1xyXG5leHBvcnQgdHlwZSBSYXdSYWlkVHdlZXRNaW5pID0gei5pbmZlcjx0eXBlb2YgelJhd1JhaWRUd2VldE1pbmk+O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1pbmlmeVJhd1JhaWRUd2VldCh0d2VldDogUmF3UmFpZFR3ZWV0KTogUmF3UmFpZFR3ZWV0TWluaSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIG46IHR3ZWV0Lm5hbWUsXHJcbiAgICBzbjogdHdlZXQuc2NyZWVuX25hbWUsXHJcbiAgICBlbjogdHdlZXQuZW5lbXlfbmFtZSxcclxuICAgIHVpOiB0d2VldC51c2VyX2lkLFxyXG4gICAgdGk6IHR3ZWV0LnR3ZWV0X2lkLFxyXG4gICAgYmk6IHR3ZWV0LmJhdHRsZV9pZCxcclxuICAgIGx2OiB0d2VldC5sZXZlbCxcclxuICAgIGw6IHR3ZWV0Lmxhbmd1YWdlLFxyXG4gICAgdDogdHdlZXQudGltZSxcclxuICAgIGM6IHR3ZWV0LmNvbW1lbnQsXHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVucGFja1Jhd1JhaWRUd2VldE1pbmkobWluaTogUmF3UmFpZFR3ZWV0TWluaSk6IFJhd1JhaWRUd2VldCB7XHJcbiAgcmV0dXJuIHtcclxuICAgIG5hbWU6IG1pbmkubixcclxuICAgIHNjcmVlbl9uYW1lOiBtaW5pLnNuLFxyXG4gICAgZW5lbXlfbmFtZTogbWluaS5lbixcclxuICAgIHVzZXJfaWQ6IG1pbmkudWksXHJcbiAgICB0d2VldF9pZDogbWluaS50aSxcclxuICAgIGJhdHRsZV9pZDogbWluaS5iaSxcclxuICAgIGxldmVsOiBtaW5pLmx2LFxyXG4gICAgbGFuZ3VhZ2U6IG1pbmkubCxcclxuICAgIHRpbWU6IG1pbmkudCxcclxuICAgIGNvbW1lbnQ6IG1pbmkuYyxcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogXHU1QjlGXHU5NjlCXHUzMDZCXHU5MTREXHU0RkUxXHUzMDU1XHUzMDhDXHUzMDhCXHUzMEM0XHUzMEE0XHUzMEZDXHUzMEM4XHUzMEM3XHUzMEZDXHUzMEJGXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgelJhaWRUd2VldE1pbmkgPSB6Lm9iamVjdCh7XHJcbiAgbjogei5zdHJpbmcoKSwgLy8gbmFtZVxyXG4gIHNuOiB6LnN0cmluZygpLCAvLyBzY3JlZW5fbmFtZVxyXG4gIHVpOiB6Lm51bWJlcigpLCAvLyB1c2VyX2lkXHJcbiAgdGk6IHoubnVtYmVyKCksIC8vIHR3ZWV0X2lkXHJcbiAgYmk6IHouc3RyaW5nKCksIC8vIGJhdHRsZV9pZFxyXG4gIGVpOiB6Lm51bWJlcigpLCAvLyBlbmVteV9pZCgtMVx1MzA2Rlx1MzBFQVx1MzBCOVx1MzBDOFx1NTkxNilcclxuICBsdjogei5zdHJpbmcoKS5vcHRpb25hbCgpLCAvLyBsZXZlbFxyXG4gIGVuOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIGVuZW15X25hbWVcclxuICBsOiB6LmVudW0oWydlbicsICdqYSddKSwgLy8gbGFuZ3VhZ2VcclxuICB0OiB6Lm51bWJlcigpLCAvLyB0aW1lXHJcbiAgZnQ6IHoubnVtYmVyKCksIC8vIGZpcnN0IHRpbWUoXHU1MjFEXHU1NkRFXHU2Mjk1XHU3QTNGXHU2NjQyXHU5NTkzKVxyXG4gIGM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gY29tbWVudFxyXG59KTtcclxuZXhwb3J0IHR5cGUgUmFpZFR3ZWV0TWluaSA9IHouaW5mZXI8dHlwZW9mIHpSYWlkVHdlZXRNaW5pPjtcclxuIiwgImltcG9ydCB7IGVudiB9IGZyb20gJ0AvY29uZmlnJztcclxuaW1wb3J0IG1pdHQgZnJvbSAnbWl0dCc7XHJcbmltcG9ydCB7IHBhcnNlIH0gZnJvbSAnQHRvdG9yYWo5MzAvZ2JmLXR3ZWV0LXBhcnNlcic7XHJcbmltcG9ydCB7IFR3aXR0ZXJBcGkgfSBmcm9tICd0d2l0dGVyLWFwaS12Mic7XHJcbmltcG9ydCB7IGdldEFjdGl2ZVRva2VuTWFueSwgZGVsZXRlT0F1dGhGaWVsZCB9IGZyb20gJ0AvZGInO1xyXG5pbXBvcnQge1xyXG4gIGdldFNlYXJjaFBhcmFtLFxyXG4gIGdldFRpbWVzdGFtcCxcclxuICBpc0Vycm9yVjEsXHJcbiAgdjFTZWFyY2hUd2VldHMsXHJcbn0gZnJvbSAnLi9zY2hlbWEnO1xyXG5cclxudHlwZSBSZWNlaXZlckV2ZW50cyA9IHtcclxuICB0d2VldDogUmF3UmFpZFR3ZWV0O1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHR3ZWV0UmVjZWl2ZXIgPSBtaXR0PFJlY2VpdmVyRXZlbnRzPigpO1xyXG5cclxuZXhwb3J0IHR5cGUgUmF3UmFpZFR3ZWV0ID0ge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBzY3JlZW5fbmFtZTogc3RyaW5nO1xyXG4gIHVzZXJfaWQ6IG51bWJlcjtcclxuICB0d2VldF9pZDogbnVtYmVyO1xyXG4gIGJhdHRsZV9pZDogc3RyaW5nO1xyXG4gIGNvbW1lbnQ/OiBzdHJpbmc7XHJcbiAgZW5lbXlfbmFtZTogc3RyaW5nO1xyXG4gIGxldmVsOiBzdHJpbmc7XHJcbiAgbGFuZ3VhZ2U6ICdqYScgfCAnZW4nO1xyXG4gIHRpbWU6IG51bWJlcjtcclxufTtcclxuXHJcbnR5cGUgQ2xpZW50ID0ge1xyXG4gIHR3aXR0ZXJJZDogc3RyaW5nO1xyXG4gIHR3aXQ6IFR3aXR0ZXJBcGk7XHJcbiAgbGltaXQ6IG51bWJlcjsgLy8gXHU1OTFBXHUzMDQ0XHUzMDdCXHUzMDY5XHU1MTJBXHU1MTQ4XHJcbiAgcmVzZXRUaW1lOiBudW1iZXI7XHJcbiAgY291bnQ6IG51bWJlcjsgLy8gXHU3M0ZFXHU1NzI4XHUzMDdFXHUzMDY3XHUzMDZFXHU0RjdGXHU3NTI4XHU1NkRFXHU2NTcwXHJcbn07XHJcblxyXG5sZXQgY2xpZW50TGlzdDogQ2xpZW50W10gPSBbXTtcclxubGV0IHNpbmNlX2lkID0gMDtcclxubGV0IHN0YXJ0RmxhZyA9IGZhbHNlO1xyXG5sZXQgdGltZXI6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XHJcblxyXG4vKipcclxuICogXHUzMEE0XHUzMEYzXHUzMEJGXHUzMEZDXHUzMEQwXHUzMEVCXHU2NjQyXHU5NTkzXHUzMDkyXHU4QTA4XHU3Qjk3XHUzMDU5XHUzMDhCXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW50ZXJ2YWxUaW1lKCkge1xyXG4gIGxldCBzdW1MaW1pdCA9IDA7XHJcbiAgbGV0IHN1bVRpbWUgPSAwO1xyXG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgZm9yIChjb25zdCBjIG9mIGNsaWVudExpc3QpIHtcclxuICAgIHN1bUxpbWl0ICs9IGMubGltaXQ7XHJcbiAgICBzdW1UaW1lICs9IGMucmVzZXRUaW1lIC0gbm93O1xyXG4gIH1cclxuICBjb25zdCB1c2VyTnVtID0gY2xpZW50TGlzdC5sZW5ndGg7XHJcbiAgLy8gXHU1NDA0XHUzMEU2XHUzMEZDXHUzMEI2XHUzMEZDXHUzMDZFXHU2NzAwXHU1OTI3XHU0RjdGXHU3NTI4XHU1NkRFXHU2NTcwXHUzMDkyNTBcdTU2REVcdTMwNjhcdTMwNTdcdTMwNUZcdTMwNjhcdTMwNERcdTMwNkVcdTY3MDBcdTVDMEZtc1xyXG4gIGNvbnN0IGxpbWl0NTAgPSAoMTAwMCAqIDYwICogMTUpIC8gKDUwICogdXNlck51bSk7XHJcbiAgcmV0dXJuIE1hdGgubWF4KDgwMCwgTWF0aC5tYXgobGltaXQ1MCwgc3VtVGltZSAvIHN1bUxpbWl0IC8gdXNlck51bSkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc3RhcnQoKSB7XHJcbiAgaWYgKHRpbWVyKSBjbGVhclRpbWVvdXQodGltZXIpO1xyXG4gIHN0YXJ0RmxhZyA9IHRydWU7XHJcbiAgdGFzaygpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc3RvcCgpIHtcclxuICBpZiAodGltZXIpIGNsZWFyVGltZW91dCh0aW1lcik7XHJcbiAgc3RhcnRGbGFnID0gZmFsc2U7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBcdTMwQTRcdTMwRjNcdTMwQkZcdTMwRkNcdTMwRDBcdTMwRUJcdTMwNTRcdTMwNjhcdTMwNkJcdTVCOUZcdTg4NENcdTMwNTVcdTMwOENcdTMwOEJcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0YXNrKCkge1xyXG4gIGxldCByZXMgPSBudWxsO1xyXG4gIHRyeSB7XHJcbiAgICByZXMgPSBhd2FpdCBnZXRUd2VldCgpO1xyXG4gIH0gY2F0Y2gge31cclxuICBpZiAocmVzID09PSBudWxsKSB7XHJcbiAgICBpZiAoc3RhcnRGbGFnKSB7XHJcbiAgICAgIHRpbWVyID0gc2V0VGltZW91dCh0YXNrLCAxKTtcclxuICAgIH1cclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgZm9yIChsZXQgaSA9IHJlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgdHdlZXRSZWNlaXZlci5lbWl0KCd0d2VldCcsIHJlc1tpXSk7XHJcbiAgfVxyXG4gIGlmIChzdGFydEZsYWcpIHtcclxuICAgIGNvbnN0IGludGVydmFsVGltZSA9IGdldEludGVydmFsVGltZSgpO1xyXG4gICAgY29uc29sZS5sb2coZ2V0VGltZXN0YW1wKCksIGludGVydmFsVGltZSk7XHJcbiAgICB0aW1lciA9IHNldFRpbWVvdXQodGFzaywgaW50ZXJ2YWxUaW1lKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBcdTRGNEVcdTMwNDRcdTMwN0JcdTMwNjlcdTUxMkFcdTUxNDhcclxuICovXHJcbmZ1bmN0aW9uIGdldFNjb3JlKGNsaWVudDogQ2xpZW50KSB7XHJcbiAgcmV0dXJuIChjbGllbnQucmVzZXRUaW1lIC0gRGF0ZS5ub3coKSkgLyBjbGllbnQubGltaXQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBcdTRGN0ZcdTc1MjhcdTMwNTlcdTMwOEJcdTMwQUZcdTMwRTlcdTMwQTRcdTMwQTJcdTMwRjNcdTMwQzhcdTMwOTJcdTZDN0FcdTMwODFcdTMwOEJcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50Q2xpZW50KCkge1xyXG4gIGNvbnN0IG5vd1RpbWUgPSBEYXRlLm5vdygpO1xyXG4gIGZvciAoY29uc3QgYyBvZiBjbGllbnRMaXN0KSB7XHJcbiAgICAvLyBcdTRGN0ZcdTc1MjhcdTU2REVcdTY1NzBcdTMwNEMwXHU1NkRFXHUzMDZBXHUzMDg5XHU2NzAwXHU1MTJBXHU1MTQ4XHJcbiAgICBpZiAoYy5jb3VudCA9PT0gMCkgcmV0dXJuIGM7XHJcbiAgICAvLyBcdTMwRUNcdTMwRkNcdTMwQzhcdTUyMzZcdTk2NTBcdTY2RjRcdTY1QjBcdTY2NDJcdTk1OTNcdTMwOTJcdTkwNEVcdTMwNEVcdTMwNjZcdTMwNDRcdTMwOEJcdTMwNkFcdTMwODlcdTUxMkFcdTUxNDhcclxuICAgIGlmIChjLnJlc2V0VGltZSA8IG5vd1RpbWUpIHJldHVybiBjO1xyXG4gIH1cclxuICAvLyAxLiBcdTMwRUNcdTMwRkNcdTMwQzhcdTUyMzZcdTk2NTBcdTMwN0VcdTMwNjdcdTMwNkVcdTU2REVcdTY1NzBcdTMwNkJcdTRGNTlcdTg4RDVcdTMwNENcdTMwNDJcdTMwOEJcclxuICAvLyAyLiBcdTRGN0ZcdTc1MjhcdTMwNjdcdTMwNERcdTMwOEJcdTk1OTNcdTk2OTRcdTMwNENcdTMwODhcdTMwOEFcdTc3RURcdTMwNDRcclxuICBjbGllbnRMaXN0XHJcbiAgICAuc29ydCgoYSwgYikgPT4gZ2V0U2NvcmUoYSkgLSBnZXRTY29yZShiKSlcclxuICAgIC5zb3J0KChhLCBiKSA9PiBiLmxpbWl0IC0gYS5saW1pdCk7XHJcblxyXG4gIHJldHVybiBjbGllbnRMaXN0WzBdO1xyXG59XHJcblxyXG4vKipcclxuICogXHUzMEM0XHUzMEE0XHU2NTUxXHU2M0Y0XHUzMEM0XHUzMEE0XHUzMEZDXHUzMEM4XHUzMDkyXHU2OTFDXHU3RDIyXHUzMDU5XHUzMDhCXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VHdlZXQoKTogUHJvbWlzZTxSYXdSYWlkVHdlZXRbXSB8IG51bGw+IHtcclxuICBjb25zdCBjbGllbnQgPSBnZXRDdXJyZW50Q2xpZW50KCk7XHJcbiAgY29uc3QgY0luZGV4ID0gY2xpZW50TGlzdC5pbmRleE9mKGNsaWVudCk7XHJcbiAgY29uc29sZS5sb2coXHJcbiAgICBnZXRUaW1lc3RhbXAoKSxcclxuICAgIGNsaWVudC50d2l0dGVySWQsXHJcbiAgICAnY291bnQ6JyArIGNsaWVudC5jb3VudCxcclxuICAgICdsaW1pdDonICsgY2xpZW50LmxpbWl0XHJcbiAgKTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHR3aXRSZXMgPSBhd2FpdCB2MVNlYXJjaFR3ZWV0cyhjbGllbnQudHdpdCwgZ2V0U2VhcmNoUGFyYW0oc2luY2VfaWQpKTtcclxuXHJcbiAgICBzaW5jZV9pZCA9IHR3aXRSZXMuZGF0YS5zZWFyY2hfbWV0YWRhdGEubWF4X2lkO1xyXG5cclxuICAgIC8vIFx1MzBBRlx1MzBFOVx1MzBBNFx1MzBBMlx1MzBGM1x1MzBDOFx1MzA2RVx1NjBDNVx1NTgzMVx1NjZGNFx1NjVCMFxyXG4gICAgY2xpZW50TGlzdFtjSW5kZXhdLmxpbWl0ID0gdHdpdFJlcy5yYXRlTGltaXQ/LnJlbWFpbmluZyA/PyAwO1xyXG4gICAgY2xpZW50TGlzdFtjSW5kZXhdLnJlc2V0VGltZSA9XHJcbiAgICAgICh0d2l0UmVzLnJhdGVMaW1pdD8ucmVzZXQgPz8gRGF0ZS5ub3coKSAvIDEwMDApICogMTAwMDtcclxuICAgIGNsaWVudExpc3RbY0luZGV4XS5jb3VudCsrO1xyXG5cclxuICAgIHJldHVybiB0d2l0UmVzLmRhdGEuc3RhdHVzZXMuZmxhdE1hcCgodHdlZXQpOiBSYXdSYWlkVHdlZXRbXSA9PiB7XHJcbiAgICAgIGNvbnN0IGdic1R3ZWV0ID0gcGFyc2UodHdlZXQudGV4dCk7XHJcbiAgICAgIGlmICghZ2JzVHdlZXQpIHJldHVybiBbXTtcclxuXHJcbiAgICAgIHJldHVybiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgYmF0dGxlX2lkOiBnYnNUd2VldC5iYXR0bGVJZCxcclxuICAgICAgICAgIGVuZW15X25hbWU6IGdic1R3ZWV0LmVuZW15TmFtZSxcclxuICAgICAgICAgIGxhbmd1YWdlOiBnYnNUd2VldC5sYW5ndWFnZSxcclxuICAgICAgICAgIGxldmVsOiBnYnNUd2VldC5sZXZlbCxcclxuICAgICAgICAgIG5hbWU6IHR3ZWV0LnVzZXIubmFtZSxcclxuICAgICAgICAgIHNjcmVlbl9uYW1lOiB0d2VldC51c2VyLnNjcmVlbl9uYW1lLFxyXG4gICAgICAgICAgdXNlcl9pZDogdHdlZXQudXNlci5pZCxcclxuICAgICAgICAgIHR3ZWV0X2lkOiB0d2VldC5pZCxcclxuICAgICAgICAgIHRpbWU6IG5ldyBEYXRlKHR3ZWV0LmNyZWF0ZWRfYXQpLmdldFRpbWUoKSxcclxuICAgICAgICAgIGNvbW1lbnQ6IGdic1R3ZWV0LmNvbW1lbnQsXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc3QgZXJyb3JzID0gVHdpdHRlckFwaS5nZXRFcnJvcnMoZXJyKTtcclxuICAgIGZvciAoY29uc3QgZSBvZiBlcnJvcnMpIHtcclxuICAgICAgaWYgKGlzRXJyb3JWMShlKSkge1xyXG4gICAgICAgIGlmIChlLmNvZGUgPT09IDg5KSB7XHJcbiAgICAgICAgICAvLyAnSW52YWxpZCBvciBleHBpcmVkIHRva2VuLidcclxuICAgICAgICAgIGF3YWl0IGRpc2FibGVDbGllbnQoY0luZGV4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihnZXRUaW1lc3RhbXAoKSwgZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFx1MzBBRlx1MzBFOVx1MzBBNFx1MzBBMlx1MzBGM1x1MzBDOFx1MzA5Mlx1NzEyMVx1NTJCOVx1MzA2Qlx1MzA1OVx1MzA4QlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRpc2FibGVDbGllbnQoaW5kZXg6IG51bWJlcikge1xyXG4gIGNvbnN0IGNsaWVudCA9IGNsaWVudExpc3RbaW5kZXhdO1xyXG4gIGlmICghY2xpZW50KSByZXR1cm4gZmFsc2U7XHJcbiAgLy8gY2xpZW50TGlzdFx1MzA0Qlx1MzA4OVx1NTI0QVx1OTY2NFxyXG4gIGNsaWVudExpc3Quc3BsaWNlKGluZGV4LCAxKTtcclxuICAvLyBEQlx1MzA5Mlx1NjZGNFx1NjVCMFxyXG4gIGF3YWl0IGRlbGV0ZU9BdXRoRmllbGQoY2xpZW50LnR3aXR0ZXJJZCk7XHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBcdTMwQUZcdTMwRTlcdTMwQTRcdTMwQTJcdTMwRjNcdTMwQzhcdTMwOTJcdTUyMURcdTY3MUZcdTUzMTZcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbml0Q2xpZW50TGlzdCgpIHtcclxuICBjb25zdCB1c2VycyA9IGF3YWl0IGdldEFjdGl2ZVRva2VuTWFueSgpO1xyXG4gIGNsaWVudExpc3QgPSB1c2Vycy5tYXAoKHVzZXIpID0+IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHR3aXQ6IG5ldyBUd2l0dGVyQXBpKHtcclxuICAgICAgICBhcHBLZXk6IGVudi5DT05TVU1FUl9LRVksXHJcbiAgICAgICAgYXBwU2VjcmV0OiBlbnYuQ09OU1VNRVJfU0VDUkVULFxyXG4gICAgICAgIGFjY2Vzc1Rva2VuOiB1c2VyLm9hdXRoVG9rZW4hLFxyXG4gICAgICAgIGFjY2Vzc1NlY3JldDogdXNlci5vYXV0aFRva2VuU2VjcmV0ISxcclxuICAgICAgfSksXHJcbiAgICAgIHR3aXR0ZXJJZDogdXNlci50d2l0dGVySWQsXHJcbiAgICAgIC8vIFx1NjcwMFx1NTkyN1x1NTAyNFx1MzA5Mlx1NTIxRFx1NjcxRlx1NTAyNFx1MzA2Qlx1MzA1OVx1MzA4QlxyXG4gICAgICBsaW1pdDogMTgwLFxyXG4gICAgICByZXNldFRpbWU6IERhdGUubm93KCkgKyAxMDAwICogNjAgKiAxNSxcclxuICAgICAgY291bnQ6IDAsXHJcbiAgICB9O1xyXG4gIH0pO1xyXG59XHJcbiIsICJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XHJcbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcclxuaW1wb3J0IHsgdjQgYXMgdXVpZCB9IGZyb20gJ3V1aWQnO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJzRnJvbVNlc3Npb24oc2Vzc2lvblRva2VuOiBzdHJpbmcpIHtcclxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgcHJpc21hLnNlc3Npb24uZmluZFVuaXF1ZSh7XHJcbiAgICB3aGVyZTogeyBzZXNzaW9uVG9rZW4gfSxcclxuICAgIGluY2x1ZGU6IHsgdXNlcjogdHJ1ZSB9LFxyXG4gIH0pO1xyXG4gIGlmICghc2Vzc2lvbikgcmV0dXJuIG51bGw7XHJcbiAgaWYgKHNlc3Npb24uZXhwaXJlcyA8PSBuZXcgRGF0ZSgpKSB7XHJcbiAgICBhd2FpdCBwcmlzbWEuc2Vzc2lvbi5kZWxldGVNYW55KHtcclxuICAgICAgd2hlcmU6IHsgaWQ6IHNlc3Npb24uaWQgfSxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG4gIGlmICghc2Vzc2lvbi51c2VyLm9hdXRoVG9rZW4gfHwgIXNlc3Npb24udXNlci5vYXV0aFRva2VuU2VjcmV0KSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgcmV0dXJuIHNlc3Npb24udXNlcjtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlU2Vzc2lvblRva2VuKHVzZXJJZDogc3RyaW5nKSB7XHJcbiAgY29uc3Qgc2Vzc2lvblRva2VuID0gdXVpZCgpO1xyXG4gIGNvbnN0IGV4cGlyZXMgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMTAwMCAqIDYwICogNjAgKiAxMik7XHJcbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHByaXNtYS5zZXNzaW9uLmNyZWF0ZSh7XHJcbiAgICBkYXRhOiB7XHJcbiAgICAgIHNlc3Npb25Ub2tlbixcclxuICAgICAgZXhwaXJlcyxcclxuICAgICAgdXNlcjogeyBjb25uZWN0OiB7IGlkOiB1c2VySWQgfSB9LFxyXG4gICAgfSxcclxuICB9KTtcclxuICByZXR1cm4gc2Vzc2lvbjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZVNlc3Npb24oc2Vzc2lvblRva2VuOiBzdHJpbmcpIHtcclxuICByZXR1cm4gcHJpc21hLnNlc3Npb24uZGVsZXRlTWFueSh7XHJcbiAgICB3aGVyZTogeyBzZXNzaW9uVG9rZW4gfSxcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRvZ2dsZUFjdGl2ZSh1c2VySWQ6IHN0cmluZywgaXNBY3RpdmU6IGJvb2xlYW4pIHtcclxuICBhd2FpdCBwcmlzbWEudXNlci51cGRhdGVNYW55KHtcclxuICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcclxuICAgIGRhdGE6IHsgaXNBY3RpdmUgfSxcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZU9BdXRoRmllbGQodHdpdHRlcklkOiBzdHJpbmcpIHtcclxuICBhd2FpdCBwcmlzbWEudXNlci51cGRhdGVNYW55KHtcclxuICAgIHdoZXJlOiB7IHR3aXR0ZXJJZCB9LFxyXG4gICAgZGF0YToge1xyXG4gICAgICBvYXV0aFRva2VuOiBudWxsLFxyXG4gICAgICBvYXV0aFRva2VuU2VjcmV0OiBudWxsLFxyXG4gICAgICBpc0FjdGl2ZTogZmFsc2UsXHJcbiAgICB9LFxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBzZXJ0VXNlcih7XHJcbiAgdHdpdHRlcklkLFxyXG4gIHNjcmVlbk5hbWUsXHJcbiAgb2F1dGhUb2tlbixcclxuICBvYXV0aFRva2VuU2VjcmV0LFxyXG59OiB7XHJcbiAgdHdpdHRlcklkOiBzdHJpbmc7XHJcbiAgc2NyZWVuTmFtZTogc3RyaW5nO1xyXG4gIG9hdXRoVG9rZW46IHN0cmluZztcclxuICBvYXV0aFRva2VuU2VjcmV0OiBzdHJpbmc7XHJcbn0pIHtcclxuICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIudXBzZXJ0KHtcclxuICAgIHdoZXJlOiB7IHR3aXR0ZXJJZCB9LFxyXG4gICAgdXBkYXRlOiB7XHJcbiAgICAgIHNjcmVlbk5hbWUsXHJcbiAgICAgIG9hdXRoVG9rZW4sXHJcbiAgICAgIG9hdXRoVG9rZW5TZWNyZXQsXHJcbiAgICB9LFxyXG4gICAgY3JlYXRlOiB7XHJcbiAgICAgIHR3aXR0ZXJJZCxcclxuICAgICAgc2NyZWVuTmFtZSxcclxuICAgICAgb2F1dGhUb2tlbixcclxuICAgICAgb2F1dGhUb2tlblNlY3JldCxcclxuICAgIH0sXHJcbiAgfSk7XHJcbiAgcmV0dXJuIHVzZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3RpdmVVc2VyQ291bnQoKSB7XHJcbiAgY29uc3QgY291bnQgPSBhd2FpdCBwcmlzbWEudXNlci5jb3VudCh7XHJcbiAgICB3aGVyZToge1xyXG4gICAgICBpc0FjdGl2ZTogdHJ1ZSxcclxuICAgICAgb2F1dGhUb2tlbjogeyBub3Q6IG51bGwgfSxcclxuICAgICAgb2F1dGhUb2tlblNlY3JldDogeyBub3Q6IG51bGwgfSxcclxuICAgIH0sXHJcbiAgfSk7XHJcbiAgcmV0dXJuIGNvdW50O1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWN0aXZlVG9rZW5NYW55KCkge1xyXG4gIHJldHVybiBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XHJcbiAgICB3aGVyZToge1xyXG4gICAgICBpc0FjdGl2ZTogdHJ1ZSxcclxuICAgICAgb2F1dGhUb2tlbjogeyBub3Q6IG51bGwgfSxcclxuICAgICAgb2F1dGhUb2tlblNlY3JldDogeyBub3Q6IG51bGwgfSxcclxuICAgIH0sXHJcbiAgfSk7XHJcbn1cclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7QUNBQSxpQkFBa0I7QUFDbEIsYUFBd0I7QUFDakIsY0FBTztBQUVQLElBQU0sVUFBVSxhQUFFLE9BQU87QUFBQSxFQUM5QixnQkFBZ0IsYUFBRSxPQUFPLEVBQUUsSUFBSTtBQUFBO0FBQUE7QUFBQSxFQUcvQixjQUFjLGFBQUUsT0FBTztBQUFBLEVBQ3ZCLGlCQUFpQixhQUFFLE9BQU87QUFBQSxFQUMxQixNQUFNLGFBQUUsT0FBTztBQUFBLEVBRWYsWUFBWSxhQUFFLE9BQU87QUFBQSxFQUNyQixhQUFhLGFBQUUsT0FBTztBQUFBLEVBRXRCLFVBQVUsYUFBRSxPQUFPLEVBQUUsSUFBSTtBQUFBLEVBRXpCLFlBQVksYUFBRSxPQUFPO0FBQUEsRUFDckIsWUFBWSxhQUFFLE9BQU87QUFBQSxFQUNyQixZQUFZLGFBQUUsT0FBTztBQUN2QixDQUFDO0FBRU0sSUFBTSxNQUFNLFFBQVEsTUFBTSxRQUFRLEdBQUc7OztBQ3BCNUMscUJBQW9DOzs7QUNEcEMsSUFBQUEsY0FBa0I7QUFLWCxJQUFNLG9CQUFvQixjQUFFLE9BQU87QUFBQSxFQUN4QyxHQUFHLGNBQUUsT0FBTztBQUFBO0FBQUEsRUFDWixJQUFJLGNBQUUsT0FBTztBQUFBO0FBQUEsRUFDYixJQUFJLGNBQUUsT0FBTztBQUFBO0FBQUEsRUFDYixJQUFJLGNBQUUsT0FBTztBQUFBO0FBQUEsRUFDYixJ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SUFBTztBQUFBLEVBQ1gsQ0FBQztBQUNELFNBQU87QUFDVDtBQUtBLElBQU0sV0FBVyxJQUFJLGVBQUFBLFFBQU0sUUFBUTtBQUs1QixTQUFTLGlCQUFpQixPQUFxQjtBQUNwRCxRQUFNLE9BQU8sbUJBQW1CLEtBQUs7QUFDckMsUUFBTSxPQUFPLEtBQUssVUFBVSxJQUFJO0FBQ2hDLFdBQVMsUUFBUSxnQkFBZ0IsSUFBSTtBQUN2QztBQUtPLFNBQVMsY0FBYyxPQUFzQjtBQUNsRCxRQUFNLE9BQU8sS0FBSyxVQUFVLEtBQUs7QUFDakMsV0FBUyxRQUFRLGtCQUFrQixJQUFJO0FBQ3pDOzs7QUU3RUEsSUFBQUMsZUFBaUI7QUFDakIsOEJBQXNCO0FBQ3RCLDRCQUEyQjs7O0FDSDNCLG9CQUE2QjtBQUU3QixrQkFBMkI7QUFEM0IsSUFBTSxTQUFTLElBQUksMkJBQWE7OztBRGV6QixJQUFNLG9CQUFnQixhQUFBQyxTQUFxQjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X3pvZCIsICJtaXR0IiwgIlJlZGlzIiwgImltcG9ydF9taXR0IiwgIm1pdHQiXQp9Cg==